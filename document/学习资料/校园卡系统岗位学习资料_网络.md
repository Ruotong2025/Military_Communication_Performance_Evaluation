# 计算机网络学习资料

## 一、网络基础理论

### 1.1 OSI七层模型与TCP/IP四层模型

#### OSI七层模型
| 层次 | 名称 | 功能 | 协议/设备 |
|------|------|------|----------|
| 7 | 应用层 | 为应用程序提供网络服务 | HTTP、FTP、SMTP、DNS |
| 6 | 表示层 | 数据格式转换、加密解密 | SSL、JPEG、ASCII |
| 5 | 会话层 | 建立、管理、终止会话 | RPC、SQL |
| 4 | 传输层 | 端到端的数据传输 | TCP、UDP |
| 3 | 网络层 | 路由选择、逻辑寻址 | IP、ICMP、路由器 |
| 2 | 数据链路层 | 物理寻址、差错检测 | Ethernet、PPP、交换机 |
| 1 | 物理层 | 比特流传输 | 网线、光纤、集线器 |

#### TCP/IP四层模型
1. **应用层**：HTTP、FTP、DNS、SMTP
2. **传输层**：TCP、UDP
3. **网络层**：IP、ICMP、ARP
4. **网络接口层**：Ethernet、WiFi

### 1.2 常用网络协议

#### TCP协议（传输控制协议）
**特点**：
- 面向连接
- 可靠传输
- 流量控制
- 拥塞控制

**三次握手**：
```
客户端                    服务器
  |                         |
  |----SYN(seq=x)---------->|  第一次握手
  |                         |
  |<---SYN+ACK(seq=y,ack=x+1)|  第二次握手
  |                         |
  |----ACK(ack=y+1)-------->|  第三次握手
  |                         |
  |    建立连接完成          |
```

**四次挥手**：
```
客户端                    服务器
  |                         |
  |----FIN(seq=u)---------->|  第一次挥手
  |                         |
  |<---ACK(ack=u+1)---------|  第二次挥手
  |                         |
  |<---FIN(seq=w)-----------|  第三次挥手
  |                         |
  |----ACK(ack=w+1)-------->|  第四次挥手
  |                         |
  |    连接关闭完成          |
```

#### UDP协议（用户数据报协议）
**特点**：
- 无连接
- 不可靠传输
- 开销小、速度快
- 适用于实时应用（视频、语音）

#### IP协议
**IPv4地址**：32位，点分十进制表示（如：192.168.1.1）
**IPv6地址**：128位，冒号十六进制表示（如：2001:0db8:85a3::8a2e:0370:7334）

**IP地址分类**：
- A类：1.0.0.0 ~ 126.255.255.255（大型网络）
- B类：128.0.0.0 ~ 191.255.255.255（中型网络）
- C类：192.0.0.0 ~ 223.255.255.255（小型网络）
- D类：224.0.0.0 ~ 239.255.255.255（组播）
- E类：240.0.0.0 ~ 255.255.255.255（保留）

**私有IP地址**：
- A类：10.0.0.0 ~ 10.255.255.255
- B类：172.16.0.0 ~ 172.31.255.255
- C类：192.168.0.0 ~ 192.168.255.255

#### HTTP/HTTPS协议
**HTTP状态码**：
- 200 OK：请求成功
- 301 Moved Permanently：永久重定向
- 302 Found：临时重定向
- 304 Not Modified：资源未修改
- 400 Bad Request：请求错误
- 401 Unauthorized：未授权
- 403 Forbidden：禁止访问
- 404 Not Found：资源不存在
- 500 Internal Server Error：服务器内部错误
- 502 Bad Gateway：网关错误
- 503 Service Unavailable：服务不可用

**HTTPS = HTTP + SSL/TLS**：加密传输，保证数据安全

#### DNS协议
**功能**：域名解析（将域名转换为IP地址）
**查询过程**：
1. 浏览器缓存
2. 操作系统缓存
3. 本地DNS服务器
4. 根DNS服务器
5. 顶级域DNS服务器
6. 权威DNS服务器

#### DHCP协议
**功能**：动态分配IP地址
**工作过程**：
1. DHCP Discover（客户端广播）
2. DHCP Offer（服务器响应）
3. DHCP Request（客户端请求）
4. DHCP ACK（服务器确认）

---

## 二、IP地址与子网划分

### 2.1 子网掩码

**作用**：区分网络部分和主机部分

**常用子网掩码**：
- /8 = 255.0.0.0（A类默认）
- /16 = 255.255.0.0（B类默认）
- /24 = 255.255.255.0（C类默认）
- /25 = 255.255.255.128
- /26 = 255.255.255.192
- /27 = 255.255.255.224
- /28 = 255.255.255.240
- /29 = 255.255.255.248
- /30 = 255.255.255.252

### 2.2 子网划分计算

**例题1：将192.168.1.0/24划分为4个子网**

解答：
- 原网络：192.168.1.0/24（256个地址）
- 需要4个子网，2² = 4，需要借2位
- 新子网掩码：/26（255.255.255.192）
- 每个子网64个地址（可用62个）

子网划分结果：
1. 192.168.1.0/26（192.168.1.1 ~ 192.168.1.62）
2. 192.168.1.64/26（192.168.1.65 ~ 192.168.1.126）
3. 192.168.1.128/26（192.168.1.129 ~ 192.168.1.190）
4. 192.168.1.192/26（192.168.1.193 ~ 192.168.1.254）

**例题2：校园网IP规划**

需求：
- 教学楼A：500台设备
- 教学楼B：300台设备
- 宿舍区：1000台设备
- 办公区：100台设备

解答：
- 宿舍区：需要1024个地址，使用/22（172.16.0.0/22）
- 教学楼A：需要512个地址，使用/23（172.16.4.0/23）
- 教学楼B：需要512个地址，使用/23（172.16.6.0/23）
- 办公区：需要128个地址，使用/25（172.16.8.0/25）

### 2.3 VLSM（可变长子网掩码）

**优点**：灵活分配IP地址，减少浪费

**示例**：
```
网络：10.0.0.0/8

部门A需要1000个地址：10.0.0.0/22
部门B需要500个地址：10.0.4.0/23
部门C需要200个地址：10.0.6.0/24
部门D需要50个地址：10.0.7.0/26
```

---

## 三、网络设备与配置

### 3.1 交换机配置

#### 基本配置
```cisco
# 进入特权模式
Switch> enable
Switch#

# 进入全局配置模式
Switch# configure terminal
Switch(config)#

# 设置主机名
Switch(config)# hostname SW1
SW1(config)#

# 设置管理IP
SW1(config)# interface vlan 1
SW1(config-if)# ip address 192.168.1.10 255.255.255.0
SW1(config-if)# no shutdown
SW1(config-if)# exit

# 设置默认网关
SW1(config)# ip default-gateway 192.168.1.1

# 保存配置
SW1# copy running-config startup-config
```

#### VLAN配置
```cisco
# 创建VLAN
SW1(config)# vlan 10
SW1(config-vlan)# name Teaching
SW1(config-vlan)# exit

SW1(config)# vlan 20
SW1(config-vlan)# name Dormitory
SW1(config-vlan)# exit

# 将端口分配到VLAN
SW1(config)# interface fastethernet 0/1
SW1(config-if)# switchport mode access
SW1(config-if)# switchport access vlan 10
SW1(config-if)# exit

# 配置Trunk端口
SW1(config)# interface gigabitethernet 0/1
SW1(config-if)# switchport mode trunk
SW1(config-if)# switchport trunk allowed vlan 10,20
SW1(config-if)# exit

# 查看VLAN信息
SW1# show vlan brief
SW1# show interfaces trunk
```

### 3.2 路由器配置

#### 基本配置
```cisco
# 配置接口IP
Router(config)# interface gigabitethernet 0/0
Router(config-if)# ip address 192.168.1.1 255.255.255.0
Router(config-if)# no shutdown
Router(config-if)# exit

# 配置静态路由
Router(config)# ip route 192.168.2.0 255.255.255.0 192.168.1.2

# 配置默认路由
Router(config)# ip route 0.0.0.0 0.0.0.0 10.0.0.1

# 查看路由表
Router# show ip route
```

#### DHCP服务配置
```cisco
# 配置DHCP地址池
Router(config)# ip dhcp pool CAMPUS_CARD
Router(dhcp-config)# network 192.168.10.0 255.255.255.0
Router(dhcp-config)# default-router 192.168.10.1
Router(dhcp-config)# dns-server 8.8.8.8
Router(dhcp-config)# lease 7
Router(dhcp-config)# exit

# 排除地址
Router(config)# ip dhcp excluded-address 192.168.10.1 192.168.10.10

# 查看DHCP绑定
Router# show ip dhcp binding
```

### 3.3 ACL访问控制列表

#### 标准ACL
```cisco
# 创建标准ACL（只能基于源IP）
Router(config)# access-list 10 permit 192.168.1.0 0.0.0.255
Router(config)# access-list 10 deny any

# 应用到接口
Router(config)# interface gigabitethernet 0/0
Router(config-if)# ip access-group 10 in
Router(config-if)# exit
```

#### 扩展ACL
```cisco
# 创建扩展ACL（可基于源IP、目标IP、协议、端口）
Router(config)# access-list 100 permit tcp 192.168.1.0 0.0.0.255 any eq 80
Router(config)# access-list 100 permit tcp 192.168.1.0 0.0.0.255 any eq 443
Router(config)# access-list 100 deny ip any any

# 应用到接口
Router(config)# interface gigabitethernet 0/1
Router(config-if)# ip access-group 100 out
Router(config-if)# exit

# 查看ACL
Router# show access-lists
```

---

## 四、网络安全

### 4.1 防火墙

**功能**：
- 包过滤
- 状态检测
- 应用层网关
- NAT转换

**常见规则**：
```bash
# iptables示例（Linux）
# 允许SSH
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# 允许HTTP和HTTPS
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT

# 允许MySQL（仅内网）
iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport 3306 -j ACCEPT

# 拒绝其他所有入站流量
iptables -P INPUT DROP

# 查看规则
iptables -L -n -v
```

### 4.2 VPN技术

**类型**：
1. **IPSec VPN**：网络层加密，适合站点到站点
2. **SSL VPN**：应用层加密，适合远程接入
3. **PPTP/L2TP**：传统VPN协议

**应用场景**：
- 远程办公接入校园网
- 分校区互联
- 移动办公安全访问

### 4.3 常见网络攻击与防护

#### DDoS攻击
**防护措施**：
- 流量清洗
- CDN加速
- 限流策略
- 黑洞路由

#### ARP欺骗
**防护措施**：
```cisco
# 配置静态ARP绑定
Router(config)# arp 192.168.1.100 0011.2233.4455 arpa

# 启用动态ARP检测
Switch(config)# ip arp inspection vlan 10
```

#### 端口扫描
**检测工具**：
```bash
# 使用nmap扫描
nmap -sS 192.168.1.1

# 查看开放端口
netstat -tuln
```

---

## 五、网络故障排查

### 5.1 常用诊断命令

#### Windows命令
```cmd
# 查看IP配置
ipconfig /all

# 刷新DNS缓存
ipconfig /flushdns

# 释放和重新获取IP
ipconfig /release
ipconfig /renew

# 测试连通性
ping 192.168.1.1
ping www.baidu.com

# 路由追踪
tracert www.baidu.com

# 查看路由表
route print

# 查看网络连接
netstat -ano

# DNS查询
nslookup www.baidu.com

# 测试端口
telnet 192.168.1.1 80
```

#### Linux命令
```bash
# 查看IP配置
ifconfig
ip addr show

# 测试连通性
ping -c 4 192.168.1.1

# 路由追踪
traceroute www.baidu.com

# 查看路由表
route -n
ip route show

# 查看网络连接
netstat -tuln
ss -tuln

# DNS查询
nslookup www.baidu.com
dig www.baidu.com

# 抓包分析
tcpdump -i eth0 port 80

# 测试端口
telnet 192.168.1.1 3306
nc -zv 192.168.1.1 3306
```

### 5.2 故障排查流程

#### 校园卡设备无法联网
```
步骤1：检查物理连接
- 网线是否插好
- 指示灯是否正常
- 设备是否通电

步骤2：检查IP配置
- ping 127.0.0.1（检查本地网卡）
- ipconfig /all（查看IP地址）
- 是否获取到正确的IP

步骤3：检查网关连通性
- ping 网关IP
- 如果不通，检查VLAN配置

步骤4：检查DNS解析
- nslookup www.baidu.com
- 如果失败，检查DNS服务器配置

步骤5：检查外网连通性
- ping 8.8.8.8
- 如果不通，检查路由配置

步骤6：检查防火墙和ACL
- 查看防火墙规则
- 检查ACL配置
```

### 5.3 网络性能优化

**带宽测试**：
```bash
# 使用iperf测试带宽
# 服务器端
iperf -s

# 客户端
iperf -c 192.168.1.100 -t 30
```

**网络延迟优化**：
- 减少网络跳数
- 使用QoS优先级
- 优化路由路径
- 升级网络设备

---

## 六、校园卡系统网络架构

### 6.1 网络拓扑设计

```
                    [互联网]
                       |
                  [核心路由器]
                       |
        +-------------+-------------+
        |                           |
   [核心交换机1]              [核心交换机2]
        |                           |
   +----+----+                 +----+----+
   |         |                 |         |
[汇聚SW1] [汇聚SW2]        [汇聚SW3] [汇聚SW4]
   |         |                 |         |
[接入SW] [接入SW]          [接入SW] [接入SW]
   |         |                 |         |
[终端]   [终端]            [终端]   [终端]
```

### 6.2 VLAN规划

| VLAN ID | 名称 | 网段 | 用途 |
|---------|------|------|------|
| 10 | Management | 192.168.10.0/24 | 网络设备管理 |
| 20 | Server | 192.168.20.0/24 | 服务器区域 |
| 30 | CardDevice | 192.168.30.0/24 | 校园卡终端设备 |
| 40 | Office | 192.168.40.0/24 | 办公区域 |
| 50 | Guest | 192.168.50.0/24 | 访客网络 |

### 6.3 安全策略

**网络隔离**：
- 校园卡专网与校园网物理隔离
- 使用独立的交换机和路由器
- 配置VLAN隔离不同业务

**访问控制**：
```cisco
# 只允许管理员访问数据库服务器
access-list 101 permit tcp host 192.168.40.10 host 192.168.20.5 eq 3306
access-list 101 deny tcp any host 192.168.20.5 eq 3306
access-list 101 permit ip any any
```

**监控与日志**：
- 部署网络监控系统（Zabbix、Nagios）
- 启用设备日志记录
- 定期审计网络访问日志

---

## 七、实战练习题

### 练习1：子网划分
将172.16.0.0/16划分为以下子网：
- 子网A：需要5000个主机
- 子网B：需要2000个主机
- 子网C：需要500个主机
- 子网D：需要100个主机

### 练习2：网络故障排查
场景：某栋楼的校园卡刷卡机全部无法连接服务器
请列出详细的排查步骤和可能的原因。

### 练习3：ACL配置
要求：
1. 允许192.168.1.0/24访问Web服务器（192.168.2.10）
2. 允许192.168.1.100访问数据库服务器（192.168.2.20）
3. 拒绝其他所有访问

### 练习4：VLAN配置
在交换机上配置3个VLAN：
- VLAN 10：端口1-10
- VLAN 20：端口11-20
- VLAN 30：端口21-24（Trunk）

---

**学习建议**：
1. 理解OSI模型和TCP/IP协议栈
2. 熟练掌握子网划分计算
3. 练习交换机和路由器配置命令
4. 掌握常用网络诊断工具
5. 了解网络安全基本防护措施
6. 多做实验，搭建模拟环境练习
