# 操作系统学习资料

## 一、操作系统基础理论

### 1.1 操作系统概述

#### 操作系统的功能
1. **进程管理**：进程调度、同步、通信
2. **内存管理**：内存分配、虚拟内存、页面置换
3. **文件管理**：文件存储、目录管理、权限控制
4. **设备管理**：I/O设备管理、驱动程序
5. **用户接口**：命令行、图形界面

#### 操作系统分类
- **批处理系统**：作业成批处理
- **分时系统**：多用户交互
- **实时系统**：及时响应外部事件
- **网络操作系统**：资源共享
- **分布式系统**：多台计算机协同工作

### 1.2 进程管理

#### 进程状态
```
    [新建] → [就绪] ⇄ [运行] → [终止]
              ↑  ↓
            [阻塞]
```

- **新建**：进程正在创建
- **就绪**：等待CPU分配
- **运行**：正在执行
- **阻塞**：等待I/O或事件
- **终止**：执行完毕

#### 进程调度算法
1. **先来先服务（FCFS）**：按到达顺序执行
2. **短作业优先（SJF）**：执行时间短的优先
3. **时间片轮转（RR）**：每个进程分配固定时间片
4. **优先级调度**：按优先级执行
5. **多级反馈队列**：综合多种策略

#### 进程同步
**临界区问题**：多个进程访问共享资源

**解决方案**：
- **互斥锁（Mutex）**
- **信号量（Semaphore）**
- **管程（Monitor）**

**经典同步问题**：
- 生产者-消费者问题
- 读者-写者问题
- 哲学家就餐问题

### 1.3 内存管理

#### 内存分配方式
1. **连续分配**：
   - 固定分区
   - 动态分区（首次适应、最佳适应、最坏适应）

2. **非连续分配**：
   - 分页（Page）
   - 分段（Segment）
   - 段页式

#### 虚拟内存
**页面置换算法**：
- **FIFO**：先进先出
- **LRU**：最近最少使用
- **OPT**：最优置换（理论）
- **Clock**：时钟算法

**示例题**：
```
页面访问序列：1, 2, 3, 4, 1, 2, 5, 1, 2, 3, 4, 5
物理块数：3

FIFO算法：
1 1 1 4 4 4 5 5 5 3 3 3
  2 2 2 1 1 1 1 1 1 4 4
    3 3 3 2 2 2 2 2 2 2 5
缺页次数：9次
```

### 1.4 文件系统

#### 文件组织方式
- **顺序文件**：按顺序存储
- **索引文件**：建立索引表
- **散列文件**：通过哈希函数定位

#### 目录结构
- **单级目录**：所有文件在一个目录
- **两级目录**：用户目录+文件
- **树形目录**：多级目录结构
- **无环图目录**：允许共享

#### 磁盘调度算法
- **FCFS**：先来先服务
- **SSTF**：最短寻道时间优先
- **SCAN**：电梯算法
- **C-SCAN**：循环扫描

---

## 二、Linux系统管理

### 2.1 Linux基础命令

#### 文件操作
```bash
# 查看目录内容
ls -la

# 切换目录
cd /var/log

# 显示当前路径
pwd

# 创建目录
mkdir -p /data/backup

# 删除文件/目录
rm -f file.txt
rm -rf directory/

# 复制文件
cp source.txt dest.txt
cp -r /source/ /dest/

# 移动/重命名
mv old.txt new.txt
mv /source/ /dest/

# 查看文件内容
cat file.txt
less file.txt
head -n 20 file.txt
tail -f /var/log/syslog

# 查找文件
find /var/log -name "*.log"
find /home -type f -mtime -7

# 文件权限
chmod 755 script.sh
chmod u+x file.sh
chown user:group file.txt
```

#### 文件权限详解
```
-rwxr-xr-x  1 root root 4096 Feb 22 10:00 file.txt
│││││││││
│││││││└┴─ 其他用户权限（r-x = 5）
││││││└──── 组权限（r-x = 5）
│││└┴┴───── 所有者权限（rwx = 7）
││└───────── 文件类型（- 普通文件，d 目录，l 链接）
```

权限数字表示：
- r（读）= 4
- w（写）= 2
- x（执行）= 1

常用权限：
- 755：rwxr-xr-x（脚本、程序）
- 644：rw-r--r--（普通文件）
- 600：rw-------（敏感文件）
- 777：rwxrwxrwx（所有人可读写执行）

#### 文本处理
```bash
# 搜索文本
grep "error" /var/log/syslog
grep -r "password" /etc/
grep -i "warning" log.txt  # 忽略大小写

# 统计
wc -l file.txt  # 行数
wc -w file.txt  # 单词数

# 排序
sort file.txt
sort -n numbers.txt  # 数字排序
sort -r file.txt     # 逆序

# 去重
uniq file.txt
sort file.txt | uniq

# 文本替换
sed 's/old/new/g' file.txt
sed -i 's/old/new/g' file.txt  # 直接修改文件

# 文本提取
awk '{print $1}' file.txt
awk -F: '{print $1,$3}' /etc/passwd
```

### 2.2 进程管理

```bash
# 查看进程
ps aux
ps -ef
ps aux | grep mysql

# 实时监控
top
htop

# 查看进程树
pstree

# 杀死进程
kill PID
kill -9 PID      # 强制杀死
killall nginx    # 按名称杀死

# 后台运行
command &
nohup command &  # 不挂断运行

# 查看后台任务
jobs
fg %1            # 将后台任务调到前台
bg %1            # 继续后台任务
```

### 2.3 系统监控

```bash
# CPU和内存
top
free -h
vmstat 1

# 磁盘使用
df -h
du -sh /var/log
du -h --max-depth=1 /home

# 磁盘I/O
iostat -x 1
iotop

# 网络监控
netstat -tuln
ss -tuln
iftop
nethogs

# 系统负载
uptime
w

# 查看系统信息
uname -a
cat /etc/os-release
lscpu
free -h
```

### 2.4 服务管理

#### systemd服务管理
```bash
# 启动服务
systemctl start mysql

# 停止服务
systemctl stop mysql

# 重启服务
systemctl restart mysql

# 查看状态
systemctl status mysql

# 开机自启
systemctl enable mysql

# 禁用自启
systemctl disable mysql

# 查看所有服务
systemctl list-units --type=service

# 查看服务日志
journalctl -u mysql
journalctl -u mysql -f  # 实时查看
```

### 2.5 日志管理

```bash
# 系统日志位置
/var/log/syslog          # 系统日志
/var/log/auth.log        # 认证日志
/var/log/kern.log        # 内核日志
/var/log/mysql/error.log # MySQL错误日志
/var/log/nginx/access.log # Nginx访问日志

# 查看日志
tail -f /var/log/syslog
tail -n 100 /var/log/syslog
grep "error" /var/log/syslog

# 日志轮转配置
cat /etc/logrotate.conf
```

### 2.6 用户管理

```bash
# 创建用户
useradd -m -s /bin/bash username
passwd username

# 删除用户
userdel -r username

# 修改用户
usermod -aG sudo username  # 添加到sudo组
usermod -s /bin/bash username

# 查看用户
id username
who
w
last

# 切换用户
su - username
sudo command
```

### 2.7 网络配置

```bash
# 查看网络接口
ifconfig
ip addr show

# 配置IP地址
ip addr add 192.168.1.100/24 dev eth0
ip link set eth0 up

# 查看路由
route -n
ip route show

# 添加路由
route add -net 192.168.2.0/24 gw 192.168.1.1
ip route add 192.168.2.0/24 via 192.168.1.1

# DNS配置
cat /etc/resolv.conf
echo "nameserver 8.8.8.8" >> /etc/resolv.conf

# 防火墙
ufw status
ufw enable
ufw allow 22/tcp
ufw allow 80/tcp
ufw deny 3306/tcp
```

---

## 三、Shell脚本编程

### 3.1 Shell基础

#### 变量
```bash
#!/bin/bash

# 定义变量
name="张三"
age=25

# 使用变量
echo "姓名：$name"
echo "年龄：${age}"

# 只读变量
readonly PI=3.14

# 删除变量
unset name

# 环境变量
export PATH=$PATH:/usr/local/bin
```

#### 数组
```bash
# 定义数组
arr=(1 2 3 4 5)
names=("张三" "李四" "王五")

# 访问数组
echo ${arr[0]}      # 第一个元素
echo ${arr[@]}      # 所有元素
echo ${#arr[@]}     # 数组长度

# 遍历数组
for item in ${arr[@]}; do
    echo $item
done
```

### 3.2 条件判断

```bash
# if语句
if [ $age -gt 18 ]; then
    echo "成年人"
elif [ $age -eq 18 ]; then
    echo "刚好18岁"
else
    echo "未成年"
fi

# 文件判断
if [ -f /etc/passwd ]; then
    echo "文件存在"
fi

if [ -d /var/log ]; then
    echo "目录存在"
fi

# 字符串判断
if [ "$str1" = "$str2" ]; then
    echo "字符串相等"
fi

if [ -z "$str" ]; then
    echo "字符串为空"
fi

# 逻辑运算
if [ $a -gt 10 ] && [ $a -lt 20 ]; then
    echo "a在10到20之间"
fi
```

### 3.3 循环

```bash
# for循环
for i in {1..10}; do
    echo "数字：$i"
done

for file in /var/log/*.log; do
    echo "处理文件：$file"
done

# while循环
count=1
while [ $count -le 5 ]; do
    echo "计数：$count"
    count=$((count + 1))
done

# until循环
num=1
until [ $num -gt 5 ]; do
    echo "数字：$num"
    num=$((num + 1))
done
```

### 3.4 函数

```bash
# 定义函数
function greet() {
    echo "你好，$1"
}

# 调用函数
greet "张三"

# 带返回值的函数
function add() {
    local result=$(($1 + $2))
    echo $result
}

sum=$(add 10 20)
echo "和为：$sum"
```

### 3.5 实用脚本示例

#### 数据库备份脚本
```bash
#!/bin/bash

# 数据库备份脚本
DB_USER="root"
DB_PASS="password"
DB_NAME="campus_card_db"
BACKUP_DIR="/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
LOG_FILE="/var/log/db_backup.log"

# 创建备份目录
mkdir -p $BACKUP_DIR

# 记录开始时间
echo "[$(date)] 开始备份数据库 $DB_NAME" >> $LOG_FILE

# 执行备份
mysqldump -u$DB_USER -p$DB_PASS $DB_NAME > $BACKUP_DIR/${DB_NAME}_${DATE}.sql

# 检查备份是否成功
if [ $? -eq 0 ]; then
    echo "[$(date)] 备份成功：${DB_NAME}_${DATE}.sql" >> $LOG_FILE
    
    # 压缩备份文件
    gzip $BACKUP_DIR/${DB_NAME}_${DATE}.sql
    echo "[$(date)] 压缩完成" >> $LOG_FILE
    
    # 删除7天前的备份
    find $BACKUP_DIR -name "*.sql.gz" -mtime +7 -delete
    echo "[$(date)] 清理旧备份完成" >> $LOG_FILE
else
    echo "[$(date)] 备份失败！" >> $LOG_FILE
    exit 1
fi

echo "[$(date)] 备份任务完成" >> $LOG_FILE
```

#### 系统监控脚本
```bash
#!/bin/bash

# 系统监控脚本
LOG_FILE="/var/log/system_monitor.log"
ALERT_EMAIL="admin@example.com"

# CPU使用率
cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)

# 内存使用率
mem_usage=$(free | grep Mem | awk '{printf("%.2f", $3/$2 * 100)}')

# 磁盘使用率
disk_usage=$(df -h / | tail -1 | awk '{print $5}' | cut -d'%' -f1)

# 记录日志
echo "[$(date)] CPU: ${cpu_usage}%, MEM: ${mem_usage}%, DISK: ${disk_usage}%" >> $LOG_FILE

# 告警判断
if (( $(echo "$cpu_usage > 80" | bc -l) )); then
    echo "警告：CPU使用率过高 ${cpu_usage}%" | mail -s "CPU告警" $ALERT_EMAIL
fi

if (( $(echo "$mem_usage > 80" | bc -l) )); then
    echo "警告：内存使用率过高 ${mem_usage}%" | mail -s "内存告警" $ALERT_EMAIL
fi

if [ $disk_usage -gt 80 ]; then
    echo "警告：磁盘使用率过高 ${disk_usage}%" | mail -s "磁盘告警" $ALERT_EMAIL
fi
```

#### 日志清理脚本
```bash
#!/bin/bash

# 日志清理脚本
LOG_DIR="/var/log/campus_card"
DAYS=30

# 清理30天前的日志
find $LOG_DIR -name "*.log" -mtime +$DAYS -delete

# 压缩7天前的日志
find $LOG_DIR -name "*.log" -mtime +7 -mtime -$DAYS -exec gzip {} \;

echo "[$(date)] 日志清理完成" >> /var/log/log_cleanup.log
```

---

## 四、Windows Server管理

### 4.1 基本管理

#### PowerShell常用命令
```powershell
# 查看系统信息
Get-ComputerInfo
systeminfo

# 查看进程
Get-Process
Get-Process | Where-Object {$_.CPU -gt 100}

# 查看服务
Get-Service
Get-Service | Where-Object {$_.Status -eq "Running"}

# 启动/停止服务
Start-Service -Name "MySQL"
Stop-Service -Name "MySQL"
Restart-Service -Name "MySQL"

# 查看网络配置
Get-NetIPAddress
Get-NetRoute

# 查看磁盘
Get-Disk
Get-Volume

# 查看事件日志
Get-EventLog -LogName System -Newest 100
Get-EventLog -LogName Application -EntryType Error
```

### 4.2 用户管理

```powershell
# 创建用户
New-LocalUser -Name "cardadmin" -Password (ConvertTo-SecureString "P@ssw0rd" -AsPlainText -Force)

# 添加到管理员组
Add-LocalGroupMember -Group "Administrators" -Member "cardadmin"

# 查看用户
Get-LocalUser
Get-LocalGroupMember -Group "Administrators"

# 删除用户
Remove-LocalUser -Name "cardadmin"
```

### 4.3 任务计划

```powershell
# 创建计划任务
$action = New-ScheduledTaskAction -Execute "PowerShell.exe" -Argument "C:\Scripts\backup.ps1"
$trigger = New-ScheduledTaskTrigger -Daily -At 2am
Register-ScheduledTask -TaskName "DatabaseBackup" -Action $action -Trigger $trigger

# 查看计划任务
Get-ScheduledTask

# 运行计划任务
Start-ScheduledTask -TaskName "DatabaseBackup"
```

---

## 五、系统性能优化

### 5.1 Linux性能优化

#### CPU优化
```bash
# 查看CPU信息
lscpu
cat /proc/cpuinfo

# 查看CPU使用率
top
mpstat 1

# 调整进程优先级
nice -n 10 command
renice -n 5 -p PID
```

#### 内存优化
```bash
# 查看内存使用
free -h
cat /proc/meminfo

# 清理缓存
sync
echo 3 > /proc/sys/vm/drop_caches

# 调整swap
swapon -s
swapoff -a
swapon -a
```

#### 磁盘I/O优化
```bash
# 查看磁盘I/O
iostat -x 1
iotop

# 调整I/O调度器
cat /sys/block/sda/queue/scheduler
echo deadline > /sys/block/sda/queue/scheduler
```

### 5.2 系统调优参数

```bash
# /etc/sysctl.conf
# 网络优化
net.core.somaxconn = 65535
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 30

# 文件描述符
fs.file-max = 655360

# 应用配置
sysctl -p
```

---

## 六、实战练习

### 练习1：编写监控脚本
要求：
1. 监控CPU、内存、磁盘使用率
2. 超过阈值发送告警
3. 记录日志
4. 每5分钟执行一次

### 练习2：自动化部署
要求：
1. 安装MySQL数据库
2. 配置数据库参数
3. 创建数据库和用户
4. 导入初始数据

### 练习3：日志分析
要求：
1. 分析Nginx访问日志
2. 统计访问量最多的IP
3. 统计访问量最多的URL
4. 生成报表

---

**学习建议**：
1. 熟练掌握Linux常用命令
2. 学会编写Shell脚本自动化任务
3. 理解操作系统基本原理
4. 掌握系统监控和性能优化方法
5. 多动手实践，搭建虚拟机环境
